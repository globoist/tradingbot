<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>AI Trading Bot – Advanced Signals</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="icon" href="data:image/x-icon;," />

<style>
body { background:#0b1220; color:#e5e7eb; font-family:system-ui; margin:0 }
header { padding:14px; background:#020617; border-bottom:1px solid #1f2937 }
.wrap { max-width:1200px; margin:auto; padding:16px }
.card { background:#020617; border:1px solid #1f2937; border-radius:10px; padding:14px; margin-bottom:16px }
input,select,button { width:100%; padding:10px; border-radius:8px; background:#020617; color:#e5e7eb; border:1px solid #1f2937 }
button { background:#2563eb; border:none; font-weight:600; cursor:pointer }
table { width:100%; border-collapse:collapse }
th,td { padding:8px; border-bottom:1px solid #1f2937; text-align:left }
.buy { color:#22c55e }
.sell { color:#ef4444 }
.hold { color:#facc15 }
</style>
</head>

<body>
<header><h2>AI Trading Bot – Entry · Exit · SL · TP · MACD</h2></header>

<div class="wrap">

<div class="card">
<label>Tickers</label>
<input id="tickers" value="AAPL" /><br><br>
<label>Interval</label>
<select id="interval">
<option value="1d">1 Day</option>
<option value="1h">1 Hour</option>
</select><br><br>
<button onclick="run()">Scan Signals</button>
</div>

<div class="card">
<table>
<thead>
<tr>
<th>Ticker</th>
<th>Signal</th>
<th>Entry</th>
<th>Stop Loss</th>
<th>Take Profit</th>
<th>RSI</th>
<th>MACD</th>
<th>Confidence</th>
</tr>
</thead>
<tbody id="results"></tbody>
</table>
</div>

</div>

<script>
const PROXY = "https://tradingbot-proxy.globoist.workers.dev";

const sleep = ms => new Promise(r=>setTimeout(r,ms));

async function fetchData(symbol, interval){
  const r = await fetch(`${PROXY}/chart/${symbol}?interval=${interval}`);
  const j = await r.json();
  return j.chart.result[0].indicators.quote[0].close;
}

// ===== Indicators =====
function SMA(v,p){ return v.map((_,i)=> i<p-1?null:v.slice(i-p+1,i+1).reduce((a,b)=>a+b)/p); }

function RSI(v,p=14){
  let g=0,l=0,r=[];
  for(let i=1;i<v.length;i++){
    let d=v[i]-v[i-1];
    g+=Math.max(d,0); l+=Math.max(-d,0);
    if(i<p){ r.push(null); continue; }
    if(i===p){ g/=p; l/=p; }
    else{ g=(g*(p-1)+Math.max(d,0))/p; l=(l*(p-1)+Math.max(-d,0))/p; }
    r.push(100-100/(1+g/l));
  }
  r.unshift(null); return r;
}

function EMA(v,p){
  const k=2/(p+1); let e=v[0]; return v.map(x=> e=e+k*(x-e));
}

function MACD(v){
  const macd = EMA(v,12).map((x,i)=>x-EMA(v,26)[i]);
  const signal = EMA(macd,9);
  return macd[macd.length-1]-signal[signal.length-1];
}

// ===== Main =====
async function run(){
  const tb = document.getElementById("results");
  tb.innerHTML="";
  const tickers = document.getElementById("tickers").value.split(",").map(x=>x.trim());
  const interval = document.getElementById("interval").value;

  for(const [i,t] of tickers.entries()){
    if(i>0) await sleep(300);
    const closes = await fetchData(t,interval);
    const last = closes.at(-1);
    const rsi = RSI(closes).at(-1);
    const ma50 = SMA(closes,50).at(-1);
    const macd = MACD(closes);

    let signal="HOLD", cls="hold", conf=40;
    if(rsi<35 && last>ma50 && macd>0){ signal="BUY"; cls="buy"; conf=80; }
    else if(rsi>65 && last<ma50 && macd<0){ signal="SELL"; cls="sell"; conf=80; }

    let sl="—", tp="—";
    if(signal==="BUY"){ sl=(last*0.97).toFixed(2); tp=(last*1.06).toFixed(2); }
    if(signal==="SELL"){ sl=(last*1.03).toFixed(2); tp=(last*0.94).toFixed(2); }

    tb.innerHTML += `
    <tr>
      <td>${t}</td>
      <td class="${cls}">${signal}</td>
      <td>${last.toFixed(2)}</td>
      <td>${sl}</td>
      <td>${tp}</td>
      <td>${rsi.toFixed(1)}</td>
      <td>${macd>0?"Bullish":"Bearish"}</td>
      <td>${conf}%</td>
    </tr>`;
  }
}
</script>
</body>
</html>
